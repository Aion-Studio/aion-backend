datasource db {
  provider = "postgresql"
  url      = env("PRISMA__DATABASE__URL")
}

generator client {
  provider = "cargo prisma"
  output   = "../src/prisma.rs"
  // uncomment below for js client seed scripts
  // provider = "prisma-client-js"
}

model Hero {
  id                          String            @id @default(uuid())
  name                        String            @default("Default name")
  aionCapacity                Int
  baseStatsId                 String            @unique @map("base_stats_id")
  attributesId                String            @unique @map("attributes_id")
  baseStats                   BaseStats         @relation(fields: [baseStatsId], references: [id])
  attributes                  Attributes        @relation(fields: [attributesId], references: [id])
  inventory                   Inventory         @relation(fields: [inventoryId], references: [id])
  inventoryId                 String            @unique @map("inventory_id")
  retinueSlots                RetinueSlot[]
  heroRegion                  HeroRegion[]
  actionsCompleted            ActionCompleted[]
  resources                   HeroResource[]
  stamina                     Int               @default(100)
  staminaMax                  Int               @default(100)
  staminaRegenRate            Int               @default(1)
  heroActions                 HeroActions[]
  heroQuests                  HeroQuests[]
  lastStaminaRegenerationTime DateTime?         @map("last_stamina_regeneration_time")
  heroTalents                 HeroTalent[]
  decks                       Deck[]
  Cards                       HeroCard[]
}

model HeroResource {
  id             String       @id @default(uuid())
  heroId         String       @map("hero_id")
  hero           Hero         @relation(fields: [heroId], references: [id])
  resource       ResourceType @relation(fields: [resourceTypeId], references: [id])
  amount         Int
  resourceTypeId String       @map("resource_type_id")

  @@unique([heroId, resourceTypeId])
}

model Action {
  id          String  @id @default(uuid())
  name        String
  description String?
  region_name String  @map("region_name")
  Region      Region  @relation(fields: [region_name], references: [name])

  // Optional fields for Leyline and Quest
  leyline   Leyline? @relation(fields: [leylineId], references: [id])
  leylineId String?  @map("leyline_id")
  quest     Quest?   @relation(fields: [questId], references: [id])
  questId   String?  @map("quest_id")

  npc   Npc?    @relation("ActionToNpc", fields: [npcId], references: [id])
  npcId String? @map("npc_id")

  heroAction HeroActions[]

  cost Int? @default(0)

  @@unique([name, description, questId])
}

model HeroActions {
  id       String @id @default(uuid())
  heroId   String @map("hero_id")
  hero     Hero   @relation(fields: [heroId], references: [id])
  actionId String @map("action_id")
  action   Action @relation(fields: [actionId], references: [id])
}

model Quest {
  id             String       @id @default(uuid())
  title          String
  region_name    String       @map("region_name")
  Region         Region       @relation(fields: [region_name], references: [name])
  requiredQuests Quest[]      @relation("QuestRequirements")
  requiredBy     Quest[]      @relation("QuestRequirements")
  questNumber    Int
  actions        Action[]
  heroQuests     HeroQuests[]
  cost           Int          @default(0)
}

model HeroQuests {
  id        String  @id @default(uuid())
  heroId    String  @map("hero_id")
  hero      Hero    @relation(fields: [heroId], references: [id])
  questId   String  @map("quest_id")
  quest     Quest   @relation(fields: [questId], references: [id])
  accepted  Boolean @default(false)
  completed Boolean @default(false)
}

model ActionCompleted {
  id          String   @id @default(uuid())
  actionName  String   @map("action_name")
  heroId      String   @map("hero_id")
  hero        Hero     @relation(fields: [heroId], references: [id])
  updatedAt   DateTime @default(now()) @map("updated_at")
  createdAt   DateTime @default(now()) @map("created_at")
  completedAt DateTime @default(now()) @map("completed_at")
  lootBox     Json     @default("{}") //
}

model HeroRegion {
  id               String  @id @default(uuid())
  HeroId           String  @map("hero_id")
  discovery_level  Float   @map("discovery_level")
  Hero             Hero    @relation(fields: [HeroId], references: [id])
  Region           Region  @relation(fields: [region_name], references: [name])
  region_name      String  @map("region_name")
  current_location Boolean @default(false) @map("current_location")
}

model BaseStats {
  id         String @id @default(uuid())
  level      Int
  xp         Int
  resilience Int    @default(0)
  damageMin  Int
  damageMax  Int
  hitPoints  Int    @map("hit_points")
  armor      Int
  hero       Hero?
}

model Attributes {
  id           String     @id @default(uuid())
  strength     Int
  agility      Int
  intelligence Int
  exploration  Int
  crafting     Int
  Hero         Hero?
  Follower     Follower[]
}

model Item {
  id                  String     @id @default(uuid())
  name                String
  weight              Int
  value               Int
  activeInventoryId   String?    @map("active_inventory_id")
  activeInventory     Inventory? @relation("active", fields: [activeInventoryId], references: [id])
  backpackInventoryId String?    @map("backpack_inventory_id")
  backpackInventory   Inventory? @relation("backpack", fields: [backpackInventoryId], references: [id])
}

model Inventory {
  id       String @id @default(uuid())
  active   Item[] @relation("active")
  backpack Item[] @relation("backpack")
  hero     Hero?
}

model RetinueSlot {
  id         String    @id @default(uuid())
  slotType   String
  HeroId     String    @map("hero_id")
  Hero       Hero      @relation(fields: [HeroId], references: [id])
  Follower   Follower? @relation(fields: [followerId], references: [id])
  followerId String?
}

model Follower {
  id           String        @id @default(uuid())
  name         String
  level        Int
  attributesId String        @map("attributes_id")
  attributes   Attributes    @relation(fields: [attributesId], references: [id])
  RetinueSlot  RetinueSlot[]

  followerTalents FollowerTalent[]
}

model ResourceType {
  id           String         @id @default(uuid())
  type         ResourceEnum
  HeroResource HeroResource[]

  @@unique([type])
}

enum ResourceEnum {
  Aion
  Valor
  NexusOrb
  StormShard
}

model ResourceCost {
  id       String       @id @default(uuid())
  resource ResourceEnum
  amount   Int
}

model Region {
  name             String       @id
  adjacent_regions String[]
  HeroRegion       HeroRegion[]
  Leylines         Leyline[]
  Actions          Action[]
  Quests           Quest[]
}

model Leyline {
  id                 String @id @default(uuid())
  name               String
  xp_reward          Int    @map("xp_reward")
  RegionName         String
  Region             Region @relation(fields: [RegionName], references: [name])
  discovery_required Int
  stamina_rate       Float
  aion_rate          Float

  npcId String @unique
  npc   Npc    @relation("NpcToLeyline", fields: [npcId], references: [id])

  actions Action[] // This will relate Leyline to many Actions
}

model Talent {
  id              String           @id @default(uuid())
  name            String
  description     String?
  cooldown        Int
  effects         Json
  heroTalents     HeroTalent[]
  followerTalents FollowerTalent[]
}

// Join table for Hero and Talent
model HeroTalent {
  heroId   String
  talentId String
  hero     Hero   @relation(fields: [heroId], references: [id])
  talent   Talent @relation(fields: [talentId], references: [id])

  @@id([heroId, talentId])
}

// Join table for Follower and Talent
model FollowerTalent {
  followerId String
  talentId   String
  follower   Follower @relation(fields: [followerId], references: [id])
  talent     Talent   @relation(fields: [talentId], references: [id])

  @@id([followerId, talentId])
}

model Npc {
  id         String @id @default(uuid())
  name       String
  level      Int
  armor      Int    @default(0)
  resilience Int
  strength   Int
  agility    Int
  damageMin  Int    @default(0)
  damageMax  Int    @default(0)
  hp         Int    @default(150)

  deck   Deck?   @relation(fields: [deckId], references: [id])
  deckId String? @unique @default(uuid())

  leyline Leyline?  @relation("NpcToLeyline")
  actions Action[]  @relation("ActionToNpc")
  NpcCard NpcCard[]
}

model Card {
  id     String @id @default(uuid())
  name   String
  nation Nation
  rarity Rarity
  imgUrl String @default("https://imagedelivery.net/OnMBHZ1Vl1a2W_jlBO5uVw/d1fdf798-a967-4a89-325f-22432cf29f00/lg")

  manaCost  Int
  health    Int @default(0)
  damage    Int @default(0)
  deckLimit Int @default(2)

  cardType CardType

  HeroCards HeroCard[]
  NpcCard   NpcCard[]

  @@unique([name, nation])
}

model CardEffect {
  id             String        @id @default(uuid())
  cardId         String
  SpellEffect    SpellEffect?  @relation(fields: [spellEffectId], references: [id])
  spellEffectId  String?
  MinionEffect   MinionEffect? @relation(fields: [minionEffectId], references: [id])
  minionEffectId String?
}

model SpellEffect {
  id                     String                @id @default(uuid())
  duration               Int                   @default(0)
  CardEffect             CardEffect[]
  DamageEffect           DamageEffect?         @relation(fields: [damageEffectId], references: [id])
  damageEffectId         String?
  DazeEffect             DazeEffect?           @relation(fields: [dazeEffectId], references: [id])
  dazeEffectId           String?
  BattleCryEffect        BattleCryEffect?      @relation(fields: [battleCryEffectId], references: [id])
  battleCryEffectId      String?
  CowardiceCurseEffect   CowardiceCurseEffect? @relation(fields: [cowardiceCurseEffectId], references: [id])
  cowardiceCurseEffectId String?
  PhantomTouchEffect     PhantomTouchEffect?   @relation(fields: [phantomTouchEffectId], references: [id])
  phantomTouchEffectId   String?
  SprayOfKnivesEffect    SprayOfKnivesEffect?  @relation(fields: [sprayOfKnivesEffectId], references: [id])
  sprayOfKnivesEffectId  String?
  HealEffect             HealEffect?           @relation(fields: [healEffectId], references: [id])
  healEffectId           String?
  ArmorEffect            ArmorEffect?          @relation(fields: [armorEffectId], references: [id])
  armorEffectId          String?
  ResilienceEffect       ResilienceEffect?     @relation(fields: [resilienceEffectId], references: [id])
  resilienceEffectId     String?
  PoisonEffect           PoisonEffect?         @relation(fields: [poisonEffectId], references: [id])
  poisonEffectId         String?
  InitiativeEffect       InitiativeEffect?     @relation(fields: [initiativeEffectId], references: [id])
  initiativeEffectId     String?
  StunEffect             StunEffect?           @relation(fields: [stunEffectId], references: [id])
  stunEffectId           String?
}

model MinionEffect {
  id                      String                 @id @default(uuid())
  duration                Int                    @default(0)
  cardEffects             CardEffect[]
  EtherealEffect          EtherealEffect?        @relation(fields: [etherealEffectId], references: [id])
  etherealEffectId        String?
  TwinEffect              TwinEffect?            @relation(fields: [twinEffectId], references: [id])
  twinEffectId            String?
  CleanseEffect           CleanseEffect?         @relation(fields: [cleanseEffectId], references: [id])
  cleanseEffectId         String?
  BlockEffect             BlockEffect?           @relation(fields: [blockEffectId], references: [id])
  blockEffectId           String?
  RoarAuraEffect          RoarAuraEffect?        @relation(fields: [roarAuraEffectId], references: [id])
  roarAuraEffectId        String?
  DyingWishHealEffect     DyingWishHealEffect?   @relation(fields: [dyingWishHealEffectId], references: [id])
  dyingWishHealEffectId   String?
  DyingWishDamageEffect   DyingWishDamageEffect? @relation(fields: [dyingWishDamageEffectId], references: [id])
  dyingWishDamageEffectId String?
  TauntEffect             TauntEffect?           @relation(fields: [tauntEffectId], references: [id])
  tauntEffectId           String?
  ChargeEffect            ChargeEffect?          @relation(fields: [chargeEffectId], references: [id])
  chargeEffectId          String?
  LifestealEffect         LifestealEffect?       @relation(fields: [lifestealEffectId], references: [id])
  lifestealEffectId       String?
  PickupEffect            PickupEffect?          @relation(fields: [pickupEffectId], references: [id])
  pickupEffectId          String?
}

enum CardType {
  Spell
  Minion
}

// --------------------------              MINION EFFECTS                ---------------------------

model EtherealEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
}

model TwinEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
}

model CleanseEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
  amount       Int
}

model BlockEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
}

model RoarAuraEffect {
  id           String         @id @default(uuid())
  amount       Int
  minionEffect MinionEffect[]
}

model DyingWishHealEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
  amount       Int
}

model DyingWishDamageEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
  amount       Int
}

model TauntEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
}

model ChargeEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
}

model LifestealEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
  percentage   Float          @default(0)
}

model PickupEffect {
  id           String         @id @default(uuid())
  minionEffect MinionEffect[]
  amount       Int
}

// --------------------------              SPELL EFFECTS                ---------------------------
model DamageEffect {
  id          String                @id @default(uuid())
  spellEffect SpellEffect[]
  damage      DamageEffectDetails[]
}

model DamageEffectDetails {
  id             String        @id @default(uuid())
  amount         Int
  damageType     DamageType    @default(Physical)
  targetType     TargetType    @default(Both)
  DamageEffect   DamageEffect? @relation(fields: [damageEffectId], references: [id])
  damageEffectId String?
}

model DazeEffect {
  id          String        @id @default(uuid())
  spellEffect SpellEffect[]
}

model BattleCryEffect {
  id          String        @id @default(uuid())
  spellEffect SpellEffect[]
  amount      Int
}

model CowardiceCurseEffect {
  id          String        @id @default(uuid())
  spellEffect SpellEffect[]
  amount      Int
}

model PhantomTouchEffect {
  id String @id @default(uuid())

  spellEffect SpellEffect[]

  amount Int
}

model SprayOfKnivesEffect {
  id          String        @id @default(uuid())
  amount      Int
  spellEffect SpellEffect[]
}

model HealEffect {
  id          String        @id @default(uuid())
  amount      Int
  spellEffect SpellEffect[]
  targetType  TargetType
}

model ArmorEffect {
  id          String        @id @default(uuid())
  amount      Int
  spellEffect SpellEffect[]
}

model ResilienceEffect {
  id          String        @id @default(uuid())
  spellEffect SpellEffect[]
  amount      Int
}

model PoisonEffect {
  id          String        @id @default(uuid())
  amount      Int
  spellEffect SpellEffect[]
}

model InitiativeEffect {
  id          String        @id @default(uuid())
  spellEffect SpellEffect[]
  amount      Int
}

model StunEffect {
  spellEffect SpellEffect[]
  id          String        @id @default(uuid())
}

// this can be an NFT. The user would sell the HeroCard instance.
model HeroCard {
  id         String    @id @default(uuid())
  instanceId String    @unique @default(uuid())
  heroId     String
  cardId     String
  hero       Hero      @relation(fields: [heroId], references: [id])
  card       Card      @relation(fields: [cardId], references: [id])
  deckCard   DeckCard? @relation(fields: [deckCardId], references: [id])
  deckCardId String?   @unique
}

model NpcCard {
  id     String @id @default(uuid())
  npcId  String
  cardId String
  npc    Npc    @relation(fields: [npcId], references: [id])
  card   Card   @relation(fields: [cardId], references: [id])
}

model DeckCard {
  id       String    @id @default(uuid())
  deckId   String
  HeroCard HeroCard?
}

model Deck {
  id     String  @id @default(uuid())
  name   String  @default("my deck")
  Hero   Hero?   @relation(fields: [heroId], references: [id])
  heroId String?
  Npc    Npc?
  active Boolean @default(false)
}

enum TargetType {
  Minion
  Hero
  Both
}

enum DamageType {
  Physical
  Spell
  Chaos
}

enum Nation {
  Dusane
  Aylen
  Ironmark
  Kelidor
  Meta
}

enum Rarity {
  Common
  Rare
  Epic
  Legendary
}
