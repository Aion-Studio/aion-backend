datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "cargo prisma"
  // The location to generate the client. Is relative to the position of the schema
  output   = "../src/prisma.rs"
}

model Hero {
  id               String            @id @default(uuid())
  name             String            @default("Default name")
  aionCapacity     Int
  aionCollected    Int
  baseStatsId      String            @unique @map("base_stats_id")
  attributesId     String            @unique @map("attributes_id")
  baseStats        BaseStats         @relation(fields: [baseStatsId], references: [id])
  attributes       Attributes        @relation(fields: [attributesId], references: [id])
  inventory        Inventory         @relation(fields: [inventoryId], references: [id])
  inventoryId      String            @unique @map("inventory_id")
  retinueSlots     RetinueSlot[]
  heroRegion       HeroRegion[]
  actionsCompleted ActionCompleted[]
  resources        HeroResource[]
  stamina          Int               @default(100)
  staminaMax       Int               @default(100)
  staminaRegenRate Int               @default(1)
}

model HeroResource {
  id             String       @id @default(uuid())
  heroId         String       @map("hero_id")
  hero           Hero         @relation(fields: [heroId], references: [id])
  resource       ResourceType @relation(fields: [resourceTypeId], references: [id])
  amount         Int
  resourceTypeId String  @map("resource_type_id")
}

model ActionCompleted {
  id          String   @id @default(uuid())
  actionName  String   @map("action_name")
  heroId      String   @map("hero_id")
  hero        Hero     @relation(fields: [heroId], references: [id])
  updatedAt   DateTime @default(now()) @map("updated_at")
  createdAt   DateTime @default(now()) @map("created_at")
  completedAt DateTime @default(now()) @map("completed_at")
  lootBox     Json     @default("{}") // This is the new JSON field
}

model HeroRegion {
  id               String  @id @default(uuid())
  HeroId           String  @map("hero_id")
  region_name      String  @map("region_name")
  discovery_level  Int     @map("discovery_level")
  Hero             Hero    @relation(fields: [HeroId], references: [id])
  Region           Region  @relation(fields: [region_name], references: [name])
  current_location Boolean @default(false) @map("current_location")
}

model BaseStats {
  id        String @id @default(uuid())
  level     Int
  xp        Int
  damageMin Int
  damageMax Int
  hitPoints Int    @map("hit_points")
  mana      Int
  armor     Int
  hero      Hero?
}

model Attributes {
  id           String     @id @default(uuid())
  resilience   Int
  strength     Int
  agility      Int
  intelligence Int
  exploration  Int
  crafting     Int
  Hero         Hero?
  Follower     Follower[]
}

model Item {
  id                  String     @id @default(uuid())
  name                String
  weight              Int
  value               Int
  activeInventoryId   String?    @map("active_inventory_id")
  activeInventory     Inventory? @relation("active", fields: [activeInventoryId], references: [id])
  backpackInventoryId String?    @map("backpack_inventory_id")
  backpackInventory   Inventory? @relation("backpack", fields: [backpackInventoryId], references: [id])
}

model Inventory {
  id       String @id @default(uuid())
  active   Item[] @relation("active")
  backpack Item[] @relation("backpack")
  hero     Hero?
}

model RetinueSlot {
  id         String    @id @default(uuid())
  slotType   String
  HeroId     String    @map("hero_id")
  Hero       Hero      @relation(fields: [HeroId], references: [id])
  Follower   Follower? @relation(fields: [followerId], references: [id])
  followerId String?
}

model Follower {
  id           String        @id @default(uuid())
  name         String
  level        Int
  attributesId String        @map("attributes_id")
  attributes   Attributes    @relation(fields: [attributesId], references: [id])
  RetinueSlot  RetinueSlot[]
}

model ResourceType {
  id             String         @id @default(uuid())
  type           ResourceEnum
  materialType   MaterialType?  @relation(fields: [materialTypeId], references: [id])
  materialTypeId String?        @unique
  HeroResource   HeroResource[]
  @@unique([type])
}

enum ResourceEnum {
  Aion
  Valor
  NexusShard
  Material
}

model MaterialType {
  id           String        @id @default(uuid())
  type         MaterialEnum
  common       Common?       @relation(fields: [commonId], references: [id])
  commonId     String?       @unique
  rare         Rare?         @relation(fields: [rareId], references: [id])
  rareId       String?       @unique
  epic         Epic?         @relation(fields: [epicId], references: [id])
  epicId       String?       @unique
  resourceType ResourceType?
}

model Common {
  id           String        @id @default(uuid())
  type         CommonEnum @unique
  materialType MaterialType?
}

model Rare {
  id           String        @id @default(uuid())
  type         RareEnum
  materialType MaterialType?
}

model Epic {
  id           String        @id @default(uuid())
  type         EpicEnum
  materialType MaterialType?
}

enum MaterialEnum {
  Common
  Rare
  Epic
}

enum CommonEnum {
  IronOre
  RoughLeather
  Quartz
}

enum RareEnum {
  SilverOre
  FineLeather
  Sapphire
}

enum EpicEnum {
  MythrilOre
  Dragonhide
  Ruby
}

model ResourceCost {
  id       String       @id @default(uuid())
  resource ResourceEnum
  amount   Int
}

model Region {
  name             String       @id
  adjacent_regions String[]
  HeroRegion       HeroRegion[]
  Leylines         Leyline[]
}

model Leyline {
  id                 String @id @default(uuid())
  name               String
  xp_reward          Int    @map("xp_reward")
  RegionName         String
  Region             Region @relation(fields: [RegionName], references: [name])
  discovery_required Int
  stamina_rate       Float
  aion_rate          Float
}

// model ResourceValue {
//   id                   String             @id @default(uuid())
//   resource             ResourceType
//   value                Int
//   RegionActionResult   RegionActionResult @relation(fields: [regionActionResultId], references: [id])
//   regionActionResultId String
// }
