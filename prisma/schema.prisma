datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "cargo prisma"
  // The location to generate the client. Is relative to the position of the schema
  output   = "../src/prisma.rs"
}

model Item {
  id                  String     @id @default(uuid())
  name                String
  weight              Int
  value               Int
  activeInventoryId   String?    @map("active_inventory_id")
  activeInventory     Inventory? @relation("active", fields: [activeInventoryId], references: [id])
  backpackInventoryId String?    @map("backpack_inventory_id")
  backpackInventory   Inventory? @relation("backpack", fields: [backpackInventoryId], references: [id])
}

model Inventory {
  id       String @id @default(uuid())
  active   Item[] @relation("active") 
  backpack Item[] @relation("backpack")
  hero     Hero?
}

model Hero {
  id                 String               @id @default(uuid())
  aionCapacity       Int
  aionCollected      Int
  baseStatsId        String               @unique @map("base_stats_id")
  attributesId       String               @unique @map("attributes_id")
  baseStats          BaseStats            @relation(fields: [baseStatsId], references: [id])
  attributes         Attributes           @relation(fields: [attributesId], references: [id])
  inventory          Inventory            @relation(fields: [inventoryId], references: [id])
  inventoryId        String               @unique @map("inventory_id")
  retinueSlots       RetinueSlot[]
  heroRegion         HeroRegion[]
  exploreAction      ExploreAction[] // Added ExploreAction relation
  RegionActionResult RegionActionResult[]
  resources HeroResource[]
}

model HeroResource {
  id       String       @id @default(uuid())
  heroId   String       @map("hero_id")
  hero     Hero         @relation(fields: [heroId], references: [id])
  resource ResourceType
  amount   Int
}

model HeroRegion {
  id              String  @id @default(uuid())
  HeroId          String  @map("hero_id")
  region_name     String  @map("region_name")
  discovery_level Int     @map("discovery_level")
  Hero            Hero    @relation(fields: [HeroId], references: [id])
  Region          Region  @relation(fields: [region_name], references: [name])
  current_location Boolean @default(false) @map("current_location")
}

model BaseStats {
  id        String @id @default(uuid())
  level     Int
  xp        Int
  damageMin Int
  damageMax Int
  hitPoints Int    @map("hit_points")
  mana      Int
  armor     Int
  hero      Hero?
}

model Attributes {
  id           String     @id @default(uuid())
  resilience   Int
  strength     Int
  agility      Int
  intelligence Int
  exploration  Int
  crafting     Int
  Hero         Hero?
  Follower     Follower[]
}

model RetinueSlot {
  id         String    @id @default(uuid())
  slotType   String
  HeroId     String    @map("hero_id")
  Hero       Hero      @relation(fields: [HeroId], references: [id])
  Follower   Follower? @relation(fields: [followerId], references: [id])
  followerId String?
}

model Follower {
  id           String        @id @default(uuid())
  name         String
  level        Int
  attributesId String        @map("attributes_id")
  attributes   Attributes    @relation(fields: [attributesId], references: [id])
  RetinueSlot  RetinueSlot[]
}

enum ResourceType {
  Aion
  Valor
  NexusShard
  Oak
  IronOre
  Copper
  Silk
}

model ResourceCost {
  id       String       @id @default(uuid())
  resource ResourceType
  amount   Int
}

model Region {
  name             String          @id
  adjacent_regions String[]
  HeroRegion       HeroRegion[]
  Leylines         Leyline[]
  ExploreAction    ExploreAction[]
}

model Leyline {
  id         String @id @default(uuid())
  location   String
  xp_reward  Int    @map("xp_reward")
  RegionName String
  Region     Region @relation(fields: [RegionName], references: [name])
}

model ExploreAction {
  id              String    @id @default(uuid())
  hero_id         String // Reference to Hero model
  Hero            Hero      @relation(fields: [hero_id], references: [id]) // Added relation to Hero
  duration        Int
  region_name     String // This now refers to the Region model
  Region          Region    @relation(fields: [region_name], references: [name]) // Added relation to Region
  xp              Int
  discovery_level Int
  start_time      DateTime?
}

model ResourceValue {
  id                   String             @id @default(uuid())
  resource             ResourceType
  value                Int
  RegionActionResult   RegionActionResult @relation(fields: [regionActionResultId], references: [id])
  regionActionResultId String
}

model RegionActionResult {
  id                       String          @id @default(uuid())
  resources                ResourceValue[]
  xp                       Int
  discovery_level_increase Float
  heroId                   String          @map("hero_id")
  hero                     Hero            @relation(fields: [heroId], references: [id])
}
